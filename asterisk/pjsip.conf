[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
; Docker NAT note:
; We expose 5060 on the host and typically register a softphone to 127.0.0.1:5060.
; Without external_* settings, Asterisk advertises its container IP (e.g. 172.x),
; causing the softphone to send the final ACK to an unreachable address, and the call
; gets torn down after ~32s (retransmitted 200 OK then BYE).
external_signaling_address=127.0.0.1
external_signaling_port=5060
; IMPORTANT: This must be reachable by your softphone.
; If your softphone is on the same machine, 127.0.0.1 is fine.
; If it's on another device in your LAN, set this to your Windows host LAN IP (e.g. 192.168.1.81).
external_media_address=192.168.1.81
external_signaling_address=192.168.1.81
; CRITICAL: do NOT mark Docker bridge (172.16/12) as "local_net" for SIP.
; Otherwise Asterisk thinks the peer is local (because traffic arrives from 172.19.0.1 via Docker NAT)
; and it will NOT rewrite Contact/SDP, advertising 172.19.x which the softphone cannot reach.
;
; Mark only your real LAN + localhost as local networks.
local_net=192.168.1.0/24
local_net=127.0.0.0/8

; Local test endpoint for softphone registration
; Use this to register a softphone (e.g., X-Lite, Zoiper) for testing
[softphone]
type=endpoint
context=inbound
disallow=all
allow=ulaw
allow=alaw
transport=transport-udp
aors=softphone
identify_by=username,ip
auth=softphone
direct_media=no
trust_id_inbound=yes
rewrite_contact=yes
rtp_symmetric=yes
force_rport=yes

[softphone]
type=aor
max_contacts=1
remove_existing=yes
qualify_frequency=60

[softphone]
type=auth
auth_type=userpass
password=softphone_pass
username=softphone

; Trunk placeholder for future SVA (Service Voice API) routing
; This will be configured when connecting to external SIP providers
[trunk-placeholder]
type=endpoint
context=inbound
disallow=all
allow=ulaw
allow=alaw
transport=transport-udp
aors=trunk-placeholder

[trunk-placeholder]
type=aor
contact=sip:trunk@example.com:5060

[trunk-placeholder]
type=auth
auth_type=userpass
password=trunk_pass
username=trunk_user
